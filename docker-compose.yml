services:
  playlist-synchronizer:
    image: ghcr.io/pkarpovich/playlist-synchronizer:latest
    container_name: playlist-synchronizer
    restart: unless-stopped
    ports:
      - ${HTTP_PORT}:${HTTP_PORT}
    environment:
      DB_PATH: ${DB_PATH}
      HTTP_PORT: ${HTTP_PORT}
      SYNC_CONFIG_PATH: ${SYNC_CONFIG_PATH}
      JOB_CRON_TIME: ${JOB_CRON_TIME}
      SPOTIFY_CLIENT_ID: ${SPOTIFY_CLIENT_ID}
      SPOTIFY_CLIENT_SECRET: ${SPOTIFY_CLIENT_SECRET}
      SPOTIFY_REDIRECT_URI: ${SPOTIFY_REDIRECT_URI}
    volumes:
      - ./sync-config.json:/usr/app/sync-config.json:ro
      - auth-store:/usr/app/db

  health-service:
    image: twinproduction/gatus
    ports:
      - 8080:8080
    volumes:
      - ./gatus-config.yaml:/config/config.yaml:ro
    depends_on:
      - playlist-synchronizer

  updater:
    image: ghcr.io/umputun/updater:v0.2.0
    container_name: updater
    hostname: updater
    restart: unless-stopped
    environment:
      LISTEN: 0.0.0.0:${UPDATER_PORT}
      KEY: ${UPDATER_KEY}
      CONF: '/srv/etc/updater.yml'
    ports:
      - ${UPDATER_PORT}:${UPDATER_PORT}
    volumes:
      - ./updater.yml:/srv/etc/updater.yml:ro
      - ${UPDATER_SSH_KEY_PATH}:/home/app/.ssh/id_rsa
      - /var/run/docker.sock:/var/run/docker.sock

volumes:
  auth-store:
